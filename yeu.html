<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tr√°i Tim Qu√©t M√£ üíò</title>
  <link rel="preconnect" href="https://unpkg.com" />
  <style>
    :root {
      --pink: #ff4d6d;
      --pink-2: #ff7aa2;
      --bg1: #ffe3ec;
      --bg2: #ffd5e5;
      --shadow: 0 12px 40px rgba(0, 0, 0, 0.18);
    }
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 600px at 20% 0%, var(--bg1), transparent),
                  radial-gradient(1200px 600px at 80% 100%, var(--bg2), transparent),
                  #fff7fb;
      display: grid;
      place-items: center;
      padding: 24px;
    }

    .app {
      width: 100%;
      max-width: 880px;
      display: grid;
      gap: 20px;
    }

    header {
      text-align: center;
    }
    h1 { margin: 0; font-size: 28px; color: #d7265d; }
    p.sub { margin: 6px 0 0; color: #7a3451; }

    .panel {
      background: #fff;
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 18px;
    }

    /* Tabs */
    .tabs { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .tab { cursor: pointer; padding: 12px 14px; text-align: center; background: #fff; border-radius: 14px; border: 2px solid #ffd1e1; font-weight: 600; color: #b02a55; }
    .tab.active { background: linear-gradient(135deg, #ffd1e1, #ffe4ed); border-color: #ffb2c9; }

    .content { display: none; }
    .content.active { display: grid; gap: 14px; }

    /* Heart frame */
    .heart-wrap { display: grid; place-items: center; padding: 14px; }
    .heart {
      position: relative;
      width: min(86vw, 420px);
      aspect-ratio: 1 / 1;
      transform: rotate(-45deg);
      background: radial-gradient(circle at 30% 30%, #ff8fb3 0%, #ff5d8f 30%, #ff2e72 55%, #ff0f5f 75%, #e1004e 100%);
      box-shadow: 0 20px 50px rgba(255, 47, 114, 0.35), inset 0 10px 30px rgba(255,255,255,0.35);
      border-radius: 16% 16% 0 0;
      overflow: hidden;
      isolation: isolate;
    }
    .heart::before,
    .heart::after {
      content: "";
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: inherit;
      box-shadow: inherit;
    }
    .heart::before { left: 50%; top: 0; transform: translate(-50%, -50%) rotate(45deg); }
    .heart::after { left: 0; top: 50%; transform: translate(-50%, -50%) rotate(45deg); }

    .heart-inner {
      position: absolute;
      inset: 10%;
      transform: rotate(45deg);
      display: grid;
      place-items: center;
      background: rgba(255,255,255,0.18);
      border-radius: 16px;
      backdrop-filter: blur(4px) saturate(120%);
    }

    .cta { text-align: center; }
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: 999px;
      border: 0;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(135deg, var(--pink), var(--pink-2));
      color: #fff;
      box-shadow: 0 10px 30px rgba(255,77,109,.35);
    }
    .btn.secondary { background: #fff; color: #b02a55; border: 2px solid #ffd1e1; box-shadow: none; }

    #scanner { width: 100%; max-width: 520px; min-height: 280px; }
    #result { text-align: center; font-weight: 700; color: #9a2148; word-break: break-word; }

    /* Hearts confetti */
    .confetti { position: fixed; left: 0; top: 0; width: 100vw; height: 100vh; pointer-events: none; overflow: hidden; }
    .confetti .h { position: absolute; font-size: 18px; animation: fall 4.6s linear forwards; }
    @keyframes fall { to { transform: translateY(110vh) rotate(480deg); opacity: 0; } }

    /* QR maker */
    .maker { display: grid; gap: 12px; }
    .row { display: grid; gap: 10px; }
    .row.cols { grid-template-columns: 1fr 1fr; }
    textarea, input[type="text"] {
      width: 100%;
      padding: 12px 14px;
      border: 2px solid #ffd1e1;
      border-radius: 12px;
      font: inherit;
    }
    .qr-box {
      display: grid; place-items: center; padding: 16px; border-radius: 16px; background: #fff6fa; border: 2px dashed #ffc0d4;
    }

    footer { text-align: center; color: #9a2148; font-size: 12px; opacity: .8; }
    .hint { font-size: 12px; color: #9a2148; }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Tr√°i Tim Qu√©t M√£ üíò</h1>
      <p class="sub">Qu√©t QR t√¨nh y√™u ho·∫∑c t·∫°o m√£ ƒë·ªÉ g·ª≠i ng∆∞·ªùi th∆∞∆°ng ‚ú®</p>
    </header>

    <div class="panel">
      <div class="tabs" id="tabs">
        <div class="tab active" data-tab="scan">Qu√©t m√£</div>
        <div class="tab" data-tab="make">T·∫°o m√£ g·ª≠i ng∆∞·ªùi y√™u</div>
      </div>

      <!-- Scan Tab -->
      <section id="scan" class="content active">
        <div class="heart-wrap">
          <div class="heart">
            <div class="heart-inner">
              <div id="scanner"></div>
            </div>
          </div>
        </div>
        <div class="cta">
          <button class="btn" id="startBtn">üíó B·∫Øt ƒë·∫ßu qu√©t</button>
          <button class="btn secondary" id="stopBtn" disabled>‚úã D·ª´ng</button>
          <p class="hint">L∆∞u √Ω: C·∫ßn HTTPS ƒë·ªÉ d√πng camera (GitHub Pages/Netlify ƒë·ªÅu c√≥).</p>
        </div>
        <div id="result"></div>
      </section>

      <!-- Make Tab -->
      <section id="make" class="content">
        <div class="maker">
          <div class="row">
            <label for="msg"><strong>N·ªôi dung/ƒë∆∞·ªùng link mu·ªën g·ª≠i</strong></label>
            <textarea id="msg" rows="3" placeholder="Nh·∫≠p l·ªùi nh·∫Øn ng·ªçt ng√†o ho·∫∑c link (v√≠ d·ª•: https://...)"></textarea>
          </div>
          <div class="row cols">
            <div>
              <label for="fg">M√†u m√£</label>
              <input id="fg" type="text" value="#b3004b" />
            </div>
            <div>
              <label for="bg">N·ªÅn</label>
              <input id="bg" type="text" value="#fff0f6" />
            </div>
          </div>
          <div class="row">
            <button class="btn" id="genBtn">üíù T·∫°o m√£ QR</button>
            <button class="btn secondary" id="dlBtn" disabled>‚¨áÔ∏è T·∫£i ·∫£nh QR</button>
            <p class="hint">G·ª£i √Ω: Vi·∫øt l·ªùi t·ªè t√¨nh ·ªü tr√™n, t·∫°o m√£ r·ªìi g·ª≠i ·∫£nh QR cho ng∆∞·ªùi y√™u; m·ªü trang n√†y ƒë·ªÉ qu√©t üíû</p>
          </div>
          <div class="qr-box">
            <div id="qrcode"></div>
          </div>
        </div>
      </section>
    </div>

    <footer>Made with üíñ by An</footer>
  </div>

  <div class="confetti" id="confetti"></div>

  <!-- Libraries -->
  <script src="https://unpkg.com/html5-qrcode"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script>
    // Tabs
    const tabs = document.querySelectorAll('.tab');
    const contents = document.querySelectorAll('.content');
    tabs.forEach(t => t.addEventListener('click', () => {
      tabs.forEach(x => x.classList.remove('active'));
      contents.forEach(c => c.classList.remove('active'));
      t.classList.add('active');
      document.getElementById(t.dataset.tab).classList.add('active');
    }));

    // Scanner
    const startBtn = document.getElementById('startBtn');
    const stopBtn = document.getElementById('stopBtn');
    const resultEl = document.getElementById('result');
    const confetti = document.getElementById('confetti');
    let html5QrCode = null;

    function burstHearts() {
      for (let i = 0; i < 24; i++) {
        const h = document.createElement('div');
        h.className = 'h';
        h.textContent = ['üíñ','üíò','üíû','üíó','üíì','‚ù§Ô∏è'][Math.floor(Math.random()*6)];
        h.style.left = Math.random()*100 + 'vw';
        h.style.top = '-40px';
        h.style.fontSize = (16 + Math.random()*20) + 'px';
        h.style.filter = `drop-shadow(0 6px 10px rgba(255, 77, 109, .35))`;
        confetti.appendChild(h);
        setTimeout(() => h.remove(), 4800);
      }
    }

    async function startScan() {
      try {
        if (!html5QrCode) {
          html5QrCode = new Html5Qrcode('scanner');
        }
        startBtn.disabled = true;
        stopBtn.disabled = false;
        resultEl.textContent = 'ƒêang m·ªü camera, cho ph√©p quy·ªÅn truy c·∫≠p nh√©‚Ä¶';
        await html5QrCode.start(
          { facingMode: { exact: 'environment' } },
          { fps: 10, qrbox: { width: 250, height: 250 } },
          (decodedText) => {
            // On success
            resultEl.innerHTML = `‚úÖ ƒê√£ qu√©t: <a href="${decodedText}" target="_blank" rel="noreferrer noopener">${decodedText}</a>`;
            burstHearts();
            // Auto open link if looks like URL
            try {
              const url = new URL(decodedText);
              window.open(url.toString(), '_blank');
            } catch (_) { /* not a URL */ }
            stopScan();
          },
          (errorMsg) => {
            // Optional: show intermittent errors in console
            // console.debug(errorMsg);
          }
        );
      } catch (err) {
        startBtn.disabled = false;
        stopBtn.disabled = true;
        resultEl.textContent = 'Kh√¥ng m·ªü ƒë∆∞·ª£c camera: ' + (err && err.message ? err.message : err);
      }
    }

    async function stopScan() {
      try {
        if (html5QrCode && html5QrCode.isScanning) {
          await html5QrCode.stop();
        }
      } finally {
        startBtn.disabled = false;
        stopBtn.disabled = true;
      }
    }

    startBtn.addEventListener('click', startScan);
    stopBtn.addEventListener('click', stopScan);

    // QR Maker
    const msg = document.getElementById('msg');
    const fg = document.getElementById('fg');
    const bg = document.getElementById('bg');
    const genBtn = document.getElementById('genBtn');
    const dlBtn = document.getElementById('dlBtn');
    const qrBox = document.getElementById('qrcode');
    let qrInstance = null;

    function makeQR() {
      qrBox.innerHTML = '';
      const text = msg.value.trim() || 'Y√™u em nhi·ªÅu l·∫Øm üíñ';
      qrInstance = new QRCode(qrBox, {
        text,
        width: 240,
        height: 240,
        colorDark: fg.value || '#b3004b',
        colorLight: bg.value || '#fff0f6',
        correctLevel: QRCode.CorrectLevel.H,
      });
      dlBtn.disabled = false;
      burstHearts();
    }

    function downloadQR() {
      if (!qrInstance) return;
      // Get canvas or img inside qrBox
      const img = qrBox.querySelector('img');
      const canvas = qrBox.querySelector('canvas');
      let dataUrl = '';
      if (img && img.src) dataUrl = img.src;
      else if (canvas) dataUrl = canvas.toDataURL('image/png');
      if (!dataUrl) return;
      const a = document.createElement('a');
      a.href = dataUrl;
      a.download = 'qr-love.png';
      a.click();
    }

    genBtn.addEventListener('click', makeQR);
    dlBtn.addEventListener('click', downloadQR);
  </script>
</body>
</html>